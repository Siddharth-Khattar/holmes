---
phase: 01-foundation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - bun.lock
  - Makefile
  - lefthook.yml
  - docker-compose.yml
  - .gitignore
  - .env.example
  - backend/pyproject.toml
  - backend/uv.lock
  - backend/.python-version
  - packages/types/package.json
  - packages/types/tsconfig.json
autonomous: true

must_haves:
  truths:
    - "Running 'bun install' in root succeeds and links workspaces"
    - "Running 'uv sync' in backend directory succeeds"
    - "Running 'docker compose up -d' starts PostgreSQL locally"
    - "Running 'lefthook install' registers git hooks"
    - "Makefile targets work for common operations"
  artifacts:
    - path: "package.json"
      provides: "Bun workspace configuration"
      contains: "workspaces"
    - path: "Makefile"
      provides: "Cross-language orchestration"
      contains: "generate-types"
    - path: "backend/pyproject.toml"
      provides: "Python project configuration with Ruff"
      contains: "ruff"
    - path: "docker-compose.yml"
      provides: "Local PostgreSQL for development"
      contains: "postgres"
    - path: "lefthook.yml"
      provides: "Git hooks for linting"
      contains: "pre-commit"
  key_links:
    - from: "package.json"
      to: "packages/types"
      via: "workspace reference"
      pattern: "packages/\\*"
    - from: "Makefile"
      to: "backend/pyproject.toml"
      via: "uv commands"
      pattern: "uv run"
---

<objective>
Create the monorepo directory structure, package configurations, and development tooling.

Purpose: Establishes the foundation for all subsequent development with proper workspace setup, dependency management, and developer experience tooling.
Output: Working monorepo with Bun workspaces, uv for Python, Docker Compose for local PostgreSQL, and Lefthook for git hooks.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-infrastructure/01-CONTEXT.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root workspace configuration</name>
  <files>
    - package.json
    - .gitignore
    - .env.example
  </files>
  <action>
Create root package.json with Bun workspaces configuration:
- name: "holmes"
- private: true
- workspaces: ["frontend", "packages/*"]
- Scripts for dev:frontend, build:frontend, generate-types, lint, format
- Use patterns from 01-RESEARCH.md Pattern 7

Create comprehensive .gitignore covering:
- Node (node_modules, .next, dist)
- Python (.venv, __pycache__, *.pyc, .ruff_cache)
- Environment (.env, .env.local, .env.*.local)
- IDE (.vscode, .idea)
- Terraform (.terraform, *.tfstate*, .terraform.lock.hcl)
- OS (.DS_Store)

Create .env.example with documented environment variables:
- DATABASE_URL (format: postgresql+asyncpg://user:pass@localhost:5432/holmes)
- CORS_ORIGINS (comma-separated origins)
- DEBUG (true/false)
  </action>
  <verify>
- File package.json exists and is valid JSON
- bun install succeeds (creates bun.lockb)
  </verify>
  <done>
Root workspace config exists with proper scripts and workspace references.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Python backend project structure</name>
  <files>
    - backend/pyproject.toml
    - backend/.python-version
    - backend/app/__init__.py
    - backend/app/config.py
  </files>
  <action>
Create backend directory with uv project:

1. Create backend/.python-version with content "3.12"

2. Create backend/pyproject.toml with:
- project name: holmes-backend
- version: 0.1.0
- requires-python: ">=3.12"
- Dependencies (production):
  - fastapi>=0.128.0
  - uvicorn[standard]>=0.34.0
  - pydantic>=2.12.0
  - pydantic-settings>=2.0.0
  - sqlalchemy>=2.0.45
  - asyncpg>=0.30.0
  - alembic>=1.14.0
  - sse-starlette>=3.2.0
  - google-cloud-storage>=2.0.0
- Dev dependencies:
  - ruff>=0.14.0
  - mypy>=1.0.0
  - pydantic2-to-typescript>=0.1.0
- Ruff configuration (from 01-RESEARCH.md):
  - line-length: 88
  - target-version: py312
  - select: ["E", "F", "I", "B", "UP"]

3. Create backend/app/__init__.py (empty, ABOUTME comment only)

4. Create backend/app/config.py with pydantic-settings:
- Settings class with:
  - database_url: str
  - cors_origins: list[str] (comma-separated env parsing)
  - debug: bool = False
  - gcs_bucket: str | None = None
- Load from environment variables
  </action>
  <verify>
- cd backend && uv sync creates uv.lock and .venv
- uv run python -c "from app.config import settings" works (with env vars set)
  </verify>
  <done>
Backend Python project is configured with all dependencies and can be initialized with uv sync.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create development tooling and Docker setup</name>
  <files>
    - Makefile
    - lefthook.yml
    - docker-compose.yml
    - packages/types/package.json
    - packages/types/tsconfig.json
    - packages/types/src/generated/.gitkeep
  </files>
  <action>
1. Create Makefile with targets:
- install: bun install && cd backend && uv sync
- dev-db: docker compose up -d postgres
- stop-db: docker compose down
- generate-types: cd backend && uv run pydantic2ts --module app.schemas --output ../packages/types/src/generated/api.ts
- lint: bun run lint:frontend && cd backend && uv run ruff check .
- format: bun run format:frontend && cd backend && uv run ruff format .
- migrate: cd backend && uv run alembic upgrade head
- dev-backend: cd backend && uv run uvicorn app.main:app --reload --port 8080
- dev-frontend: bun --cwd frontend dev

2. Create lefthook.yml (from 01-RESEARCH.md):
- pre-commit hooks for ruff-check, ruff-format, eslint, prettier
- Parallel execution enabled
- Proper glob patterns for backend and frontend

3. Create docker-compose.yml:
- PostgreSQL 17 service (matching Cloud SQL version)
- Port 5432
- Volume for data persistence
- Environment: POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB

4. Create packages/types workspace:
- packages/types/package.json with name "@holmes/types", main pointing to generated
- packages/types/tsconfig.json for TypeScript compilation
- packages/types/src/generated/.gitkeep placeholder

5. Run lefthook install to register hooks
  </action>
  <verify>
- make install succeeds
- docker compose up -d postgres starts PostgreSQL
- docker compose ps shows postgres running
- psql -h localhost -U postgres -d holmes -c "SELECT 1" returns 1
- lefthook --version shows installed
  </verify>
  <done>
Development tooling is complete: Makefile orchestrates commands, Docker provides local PostgreSQL, Lefthook manages git hooks, types package ready for generated TypeScript.
  </done>
</task>

</tasks>

<verification>
1. From repo root: `bun install` succeeds
2. From repo root: `cd backend && uv sync` succeeds
3. From repo root: `docker compose up -d` starts PostgreSQL
4. From repo root: `make install` runs without errors
5. From repo root: `lefthook run pre-commit` executes (may have warnings about missing files)
</verification>

<success_criteria>
- Monorepo structure created with /backend, /frontend (placeholder), /packages/types
- bun install creates bun.lockb with workspace links
- uv sync in backend creates .venv with all dependencies
- docker compose up -d starts PostgreSQL 17
- Makefile provides all documented targets
- Lefthook hooks are registered
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md`
</output>
