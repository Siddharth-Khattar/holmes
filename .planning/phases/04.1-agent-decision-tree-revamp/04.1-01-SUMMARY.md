---
phase: 04.1-agent-decision-tree-revamp
plan: 01
subsystem: ui
tags: [reactflow, dagre, motion, css-variables, decision-tree, command-center]

requires:
  - phase: 04-core-agent-system
    provides: AgentType, AgentState, AgentConfig types and SSE event system
  - phase: 01.1-frontend-design-foundation
    provides: Holmes design tokens in globals.css, Tailwind v4 @theme

provides:
  - DecisionNode custom ReactFlow component with motion animations and portal tooltip
  - AGENT_TYPE_TINTS mapping for per-agent hue tinting on chosen nodes
  - NODE_WIDTH/NODE_HEIGHT dagre layout constants
  - Scoped .command-center-scope CSS variables for teal accent
  - @xyflow/react and @dagrejs/dagre dependencies installed

affects: [04.1-02, 04.1-03]

tech-stack:
  added: ["@xyflow/react v12.10.0", "@dagrejs/dagre v2.0.3"]
  patterns:
    - "Scoped CSS variables via .command-center-scope selector"
    - "Separate motion.div wrappers for independent animations (floating vs entrance)"
    - "Typed cubic-bezier Easing constants instead of string literals"
    - "Portal tooltip via createPortal to escape ReactFlow transform context"
    - "memo() on custom ReactFlow nodes to prevent unnecessary re-renders"

key-files:
  created:
    - "frontend/src/components/CommandCenter/DecisionNode.tsx"
  modified:
    - "frontend/src/lib/command-center-config.ts"
    - "frontend/src/app/globals.css"
    - "frontend/package.json"

key-decisions:
  - "Used cubic-bezier arrays for Easing type instead of string literals to satisfy motion/react TypeScript definitions"
  - "Separated floating animation onto a wrapper motion.div to avoid conflicting animate props with entrance animation"
  - "Retained STATUS_COLORS in config for backward compatibility with existing AgentNode.tsx until Plan 03 removes it"
  - "Used placeholders (color: '', position: {x:0,y:0}) in AGENT_CONFIGS to satisfy AgentConfig type without modifying types file"

patterns-established:
  - "Wrapper motion.div pattern: when a node needs both entrance and looping animations, use nested motion.divs with separate concerns"
  - "Scoped CSS variables: Command Center teal accent is isolated via .command-center-scope, not polluting global Holmes palette"

duration: 6min
completed: 2026-02-04
---

# Phase 4.1 Plan 01: Dependencies, Config, and DecisionNode Summary

**ReactFlow DecisionNode with teal accent system, motion entrance/float/pulse/glow animations, portal tooltip, and dagre layout constants**

## Performance

- **Duration:** 6 min
- **Started:** 2026-02-03T23:31:51Z
- **Completed:** 2026-02-03T23:38:16Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments
- Installed @xyflow/react v12.10.0 and @dagrejs/dagre v2.0.3 as project dependencies
- Added scoped .command-center-scope CSS variables with teal accent and per-agent hue tints
- Created DecisionNode component (350 lines) with full animation suite: entrance (scale 0.9->1), floating (y bounce), hover (scale 1.05), tap (scale 0.98), pulsing border (processing), text glow (chosen)
- Updated command-center-config with AGENT_TYPE_TINTS, NODE_WIDTH, NODE_HEIGHT; removed manual positions and colors

## Task Commits

Each task was committed atomically:

1. **Task 1: Install dependencies and add scoped CSS variables** - `fa5e330` (chore)
2. **Task 2: Update command-center-config and create DecisionNode component** - `a0150e2` (feat)

## Files Created/Modified
- `frontend/src/components/CommandCenter/DecisionNode.tsx` - Custom ReactFlow node with motion animations, portal tooltip, status dots, badges, warning indicator
- `frontend/src/lib/command-center-config.ts` - Removed AGENT_COLORS, added AGENT_TYPE_TINTS/NODE_WIDTH/NODE_HEIGHT, placeholder color/position values
- `frontend/src/app/globals.css` - Added .command-center-scope block with 9 CSS variables (accent, glow, 7 agent tints)
- `frontend/package.json` - Added @xyflow/react and @dagrejs/dagre dependencies

## Decisions Made
- Used typed cubic-bezier Easing arrays (`[0.0, 0.0, 0.2, 1.0]` for easeOut, `[0.42, 0.0, 0.58, 1.0]` for easeInOut) instead of string `"easeOut"` to satisfy motion/react's strict TypeScript Easing type
- Separated floating animation onto a dedicated wrapper motion.div rather than combining with entrance animation in a single animate prop -- avoids prop conflicts and is more maintainable
- Retained STATUS_COLORS export for backward compatibility with the existing AgentNode.tsx SVG component, which will be removed in Plan 03
- Used empty string and zero-position placeholders in AGENT_CONFIGS to satisfy the AgentConfig type contract without modifying the preserved types file

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Retained STATUS_COLORS for backward compatibility**
- **Found during:** Task 2 (config update)
- **Issue:** Plan specified removing STATUS_COLORS, but AgentNode.tsx imports it and would break the build
- **Fix:** Kept STATUS_COLORS with a comment noting it will be removed in Plan 03
- **Files modified:** frontend/src/lib/command-center-config.ts
- **Verification:** `bun run build` passes, AgentNode.tsx still works
- **Committed in:** a0150e2 (Task 2 commit)

---

**Total deviations:** 1 auto-fixed (1 blocking)
**Impact on plan:** Minimal -- STATUS_COLORS retained temporarily to avoid breaking existing code. Will be cleaned up in Plan 03.

## Issues Encountered
- Initial DecisionNode implementation had TypeScript issues with motion's Easing type (string not assignable to Easing) and conflicting animate props (entrance + floating on same motion.div). Fixed by using typed cubic-bezier arrays and separating floating into a wrapper motion.div.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- DecisionNode component ready for Plan 02 (sidebar) and Plan 03 (canvas integration)
- AGENT_TYPE_TINTS and NODE_WIDTH/NODE_HEIGHT exported for Plan 03's dagre layout function
- CSS variables in place for all Command Center components

---
*Phase: 04.1-agent-decision-tree-revamp*
*Completed: 2026-02-04*
