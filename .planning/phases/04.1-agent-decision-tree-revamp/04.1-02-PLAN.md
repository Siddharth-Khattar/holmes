---
phase: 04.1-agent-decision-tree-revamp
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/CommandCenter/NodeDetailsSidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking a node opens a spring-animated sidebar sliding from the right"
    - "Sidebar shows color-coded collapsible sections (Reasoning/Thinking, Description, Findings, Metadata)"
    - "Thinking traces display in a dedicated monospace section"
    - "Triage sidebar shows domain scores as colored pills and extracted entities"
    - "Orchestrator sidebar shows routing summary, file routing table, and warnings"
  artifacts:
    - path: "frontend/src/components/CommandCenter/NodeDetailsSidebar.tsx"
      provides: "Spring-animated detail sidebar with agent-type-specific sections"
      min_lines: 150
  key_links:
    - from: "frontend/src/components/CommandCenter/NodeDetailsSidebar.tsx"
      to: "frontend/src/types/command-center.ts"
      via: "imports AgentState, AgentType for typed data display"
      pattern: "AgentState"
---

<objective>
Build the NodeDetailsSidebar component -- a spring-animated right-sliding panel that displays detailed agent information with color-coded collapsible sections, agent-type-specific content, and a dedicated thinking traces section.

Purpose: Replace the current inline `AgentDetailsPanel.tsx` with a richer, animated sidebar that matches the reference design's visual spec. This component is consumed by Plan 03 when it integrates the full canvas.

Output: A standalone NodeDetailsSidebar component ready to be mounted by CommandCenter.tsx.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04.1-agent-decision-tree-revamp/04.1-CONTEXT.md
@.planning/phases/04.1-agent-decision-tree-revamp/04.1-RESEARCH.md
@DOCS/UI/agent-decision-tree-guide.md
@frontend/src/types/command-center.ts
@frontend/src/components/CommandCenter/AgentDetailsPanel.tsx
@frontend/src/lib/command-center-config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NodeDetailsSidebar component</name>
  <files>
    frontend/src/components/CommandCenter/NodeDetailsSidebar.tsx
  </files>
  <action>
  Create a NEW file `NodeDetailsSidebar.tsx` in the CommandCenter directory. Do NOT modify `AgentDetailsPanel.tsx` (it will be removed/replaced in Plan 03).

  **Props interface:**
  ```typescript
  interface NodeDetailsSidebarProps {
    isOpen: boolean;
    agentType: AgentType | null;
    agentState: AgentState | null;
    onClose: () => void;
  }
  ```

  **Spring animation (motion/react):**
  - Use `AnimatePresence` wrapping a `motion.div`
  - `initial={{ x: '100%' }}`
  - `animate={{ x: 0 }}`
  - `exit={{ x: '100%' }}`
  - `transition={{ type: 'spring', damping: 20, stiffness: 300 }}`
  - Position: `absolute right-0 top-0 h-full w-96 z-50` within the Command Center container (NOT `fixed` -- per RESEARCH open question #3, use absolute within the CC container to avoid overlapping case layout chrome)
  - Background: `var(--color-jet)` with `border-l border-stone/15`
  - Add a semi-transparent backdrop/overlay on the left side that closes the sidebar when clicked

  **Header section:**
  - Agent name (from `AGENT_CONFIGS[agentType].name`)
  - Agent description
  - Status badge with colored dot (idle/processing/complete/error)
  - Model name badge (from `AGENT_CONFIGS[agentType].model`)
  - Close button (X icon from lucide-react)
  - "Selected Path" badge when agent is chosen (status is processing or complete)
  - Background: subtle gradient using the agent-type hue tint

  **Content sections -- all collapsible, color-coded per reference guide:**

  Each section uses the existing collapsible pattern from `AgentDetailsPanel.tsx` (ChevronDown/ChevronUp toggle with Set state). Sections are collapsed by default (user expands what they need). Each section has a colored left border and subtle colored background:

  1. **Thinking Traces** (always shown if data exists)
     - Color: teal accent (`hsl(var(--cc-accent))`)
     - Background: `hsl(var(--cc-accent) / 0.05)`, border-left: `3px solid hsl(var(--cc-accent) / 0.3)`
     - Content: monospace/differentiated typography (`font-mono text-sm`) displaying thinking trace text
     - Data source: `agentState.lastResult?.metadata?.thinkingTraces` (string, up to 2000 chars)
     - If no thinking traces available, show "No thinking traces available" in muted text

  2. **Reasoning / Summary** (section varies by agent type)
     - Color: warm amber (`hsl(37 90% 68%)` -- `alt_color_a` from guide)
     - **For triage:** "Analysis Summary" -- shows file summary (short + detailed) from triage output
     - **For orchestrator:** "Routing Summary" -- shows overall routing reasoning
     - **For domain agents:** "Findings Summary" -- key findings from domain analysis
     - Data source: `agentState.lastResult?.metadata` or `agentState.lastResult?.outputs`

  3. **Agent-Type-Specific Section:**

     **Triage sidebar specifics:**
     - "Domain Scores" subsection: For each domain score, render a color-coded pill/badge. Color intensity reflects score (0-100). Use small horizontal bars or pill badges: `evidence: 100` (bright), `legal: 85` (medium), etc.
     - "Extracted Entities" subsection: List of entities with type badges (person, org, date, location, amount, legal_term)
     - "Complexity" subsection: Complexity tier badge (Low/Medium/High)
     - Data source: `agentState.lastResult?.outputs` array -- triage outputs have domain scores, entities, complexity

     **Orchestrator sidebar specifics:**
     - "File Routing Table" subsection: Table showing files x target agents x priority (from `agentState.lastResult?.routingDecisions`)
     - "Warnings" subsection: List of warnings with warning icons (from `agentState.lastResult?.metadata?.warnings`)
     - "File Groups" subsection: If available, show how files were grouped

     **Domain agent sidebar specifics:**
     - "Files Processed" subsection: Count and list of processed files
     - "Key Extractions" subsection: Structured findings from analysis

     **Knowledge Graph agent sidebar specifics:**
     - "Entities Created" subsection: Count of entities
     - "Relationships Created" subsection: Count and sample

  4. **Input Context** (from existing AgentDetailsPanel pattern)
     - Color: blue-ish (`hsl(220 50% 35%)`)
     - Shows: from-agent info, input metadata
     - Reuse the existing pattern from `AgentDetailsPanel.tsx`

  5. **Output Findings** (from existing AgentDetailsPanel pattern)
     - Color: teal accent
     - Shows: output items with type, data, confidence
     - Routing decisions if available (orchestrator)
     - Reuse the existing pattern from `AgentDetailsPanel.tsx`

  6. **Tools Called** (if any exist)
     - Color: muted gray
     - Shows: list of tool names

  7. **Processing History** (if any exist)
     - Color: muted gray
     - Shows: recent tasks with status dots and timestamps

  **Current Task section** (always visible at top when processing):
  - Blue pulsing dot indicator
  - Current file name being processed
  - Started time

  **Empty/idle state:**
  - Show "Waiting for tasks..." with spinner animation (reuse existing pattern)

  **Styling guidelines:**
  - Use Holmes design tokens: `--color-jet`, `--color-smoke`, `--color-stone`, `--color-charcoal`
  - Use teal accent from scoped variables: `hsl(var(--cc-accent))` where appropriate
  - All text sizes: section headers `text-xs uppercase tracking-wide`, content `text-sm`, metadata `text-xs`
  - Scrollable content area: `overflow-y-auto` with hidden scrollbar styling
  - Import `motion, AnimatePresence` from `motion/react` (NOT framer-motion)
  - Import icons from `lucide-react`: `X`, `ChevronDown`, `ChevronUp`, `AlertTriangle`, `Brain`, `FileText`, `Network`

  **Anti-patterns to avoid:**
  - Do NOT use `fixed` positioning (use `absolute` within CC container)
  - Do NOT import from `framer-motion`
  - Do NOT use `any` types
  - Do NOT remove or modify `AgentDetailsPanel.tsx` in this plan
  </action>
  <verify>
  - `frontend/src/components/CommandCenter/NodeDetailsSidebar.tsx` exists with 150+ lines
  - Component uses `motion/react` for AnimatePresence + spring transition
  - Component has collapsible sections with color-coded borders
  - Component handles all agent types (triage, orchestrator, financial, legal, strategy, knowledge-graph) with type-specific content
  - Thinking traces section uses monospace typography
  - No `any` types used
  - `cd frontend && bun run build` passes
  </verify>
  <done>
  NodeDetailsSidebar component created with spring animation, color-coded collapsible sections, agent-type-specific content (triage domain scores, orchestrator routing table, domain agent findings), and dedicated thinking traces section. Positioned absolutely within the Command Center container.
  </done>
</task>

</tasks>

<verification>
- NodeDetailsSidebar.tsx compiles without errors
- Spring animation configuration matches reference guide (damping: 20, stiffness: 300)
- Collapsible sections use consistent color-coding
- Triage-specific sections (domain scores, entities, complexity) are implemented
- Orchestrator-specific sections (routing table, warnings) are implemented
- `bun run build` passes
</verification>

<success_criteria>
- Sidebar slides in from right with spring animation on open
- Sidebar slides out with exit animation on close
- All sections are collapsible with expand/collapse icons
- Thinking traces display in monospace with teal accent color
- Domain scores render as colored pills for triage agent
- Routing decisions render as a table for orchestrator agent
- Current processing task shows at top with pulsing indicator
- Empty state shows waiting spinner
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-agent-decision-tree-revamp/04.1-02-SUMMARY.md`
</output>
