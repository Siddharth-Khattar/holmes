---
phase: 08-synthesis-intelligence
plan: 04
type: execute
wave: 3
depends_on: ["08-02", "08-03"]
files_modified:
  - frontend/src/types/synthesis.ts
  - frontend/src/lib/api/synthesis.ts
  - frontend/src/hooks/useSynthesisData.ts
  - frontend/src/components/verdict/VerdictView.tsx
  - frontend/src/components/verdict/VerdictSummary.tsx
  - frontend/src/components/verdict/HypothesisCard.tsx
  - frontend/src/components/verdict/ContradictionCard.tsx
  - frontend/src/components/verdict/GapCard.tsx
  - frontend/src/components/verdict/TaskCard.tsx
  - frontend/src/components/verdict/KeyFindingCard.tsx
  - frontend/src/types/detail-sidebar.ts
  - frontend/src/components/app/detail-sidebar.tsx
  - frontend/src/components/verdict/HypothesisDetailPanel.tsx
  - frontend/src/components/verdict/ContradictionDetailPanel.tsx
  - frontend/src/components/verdict/GapDetailPanel.tsx
  - frontend/src/app/(app)/cases/[id]/command-center/page.tsx
  - frontend/src/components/CommandCenter/CommandCenter.tsx
autonomous: true

must_haves:
  truths:
    - "Command Center page has tab toggle between Agent Flow and Verdict"
    - "Verdict tab is disabled/greyed with 'Analysis in progress...' before synthesis completes"
    - "Verdict tab activates when synthesis-data-ready SSE event received"
    - "Verdict view shows scrollable sections: Summary+Verdict, Key Findings, Hypotheses, Contradictions, Gaps, Tasks"
    - "Clicking any item opens DetailSidebar with full details"
    - "Hypothesis cards show colored confidence dot + percentage"
    - "Contradiction cards show side-by-side claim comparison"
  artifacts:
    - path: "frontend/src/components/verdict/VerdictView.tsx"
      provides: "Main scrollable verdict page with all sections"
      min_lines: 80
    - path: "frontend/src/hooks/useSynthesisData.ts"
      provides: "React Query hooks for all synthesis endpoints"
      exports: ["useSynthesisData", "useHypotheses", "useContradictions", "useGaps", "useTasks"]
    - path: "frontend/src/types/synthesis.ts"
      provides: "TypeScript types matching API response schemas"
    - path: "frontend/src/lib/api/synthesis.ts"
      provides: "API client functions for synthesis endpoints"
  key_links:
    - from: "frontend/src/app/(app)/cases/[id]/command-center/page.tsx"
      to: "frontend/src/components/verdict/VerdictView.tsx"
      via: "Conditional render based on activeTab state"
      pattern: "activeTab.*verdict"
    - from: "frontend/src/components/verdict/VerdictView.tsx"
      to: "frontend/src/hooks/useSynthesisData.ts"
      via: "React Query hooks for data fetching"
      pattern: "useSynthesisData|useHypotheses"
    - from: "frontend/src/types/detail-sidebar.ts"
      to: "frontend/src/components/verdict/HypothesisDetailPanel.tsx"
      via: "SidebarContentDescriptor union member"
      pattern: "verdict-hypothesis"
---

<objective>
Build the frontend Verdict view with tab toggle in Command Center, synthesis data hooks, verdict cards, and DetailSidebar integration.

Purpose: The Verdict tab is the payoff after the pipeline runs -- users see hypotheses, contradictions, gaps, verdict, key findings, and investigation tasks. This is the primary interface for case intelligence.

Output: Tab toggle in Command Center header, VerdictView with 6 sections of cards, DetailSidebar panels for each item type, React Query hooks for all synthesis APIs.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-synthesis-intelligence/08-CONTEXT.md
@.planning/phases/08-synthesis-intelligence/08-RESEARCH.md
@.planning/phases/08-synthesis-intelligence/08-01-SUMMARY.md
@.planning/phases/08-synthesis-intelligence/08-02-SUMMARY.md
@.planning/phases/08-synthesis-intelligence/08-03-SUMMARY.md
@frontend/src/app/(app)/cases/[id]/command-center/page.tsx
@frontend/src/components/CommandCenter/CommandCenter.tsx
@frontend/src/types/detail-sidebar.ts
@frontend/src/components/app/detail-sidebar.tsx
@frontend/src/hooks/useAgentStates.ts
@frontend/src/lib/api/graph.ts
@frontend/src/types/knowledge-graph.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Types, API client, and React Query hooks</name>
  <files>
    frontend/src/types/synthesis.ts
    frontend/src/lib/api/synthesis.ts
    frontend/src/hooks/useSynthesisData.ts
  </files>
  <action>
**1. Create `frontend/src/types/synthesis.ts`** with ABOUTME comment.

Define TypeScript interfaces matching the backend API response schemas:

```typescript
export interface SynthesisEvidenceItem {
  finding_id: string;
  role: "supporting" | "contradicting" | "neutral";
  excerpt: string;
}

export interface HypothesisResponse {
  id: string;
  case_id: string;
  workflow_id: string;
  claim: string;
  status: "PENDING" | "SUPPORTED" | "REFUTED";
  confidence: number; // 0-1
  evidence: SynthesisEvidenceItem[];
  source_agent: string | null;
  reasoning: string | null;
  created_at: string;
}

export interface ContradictionResponse {
  id: string;
  case_id: string;
  workflow_id: string;
  claim_a: string;
  claim_b: string;
  source_a: { finding_id: string; excerpt: string } | null;
  source_b: { finding_id: string; excerpt: string } | null;
  severity: "minor" | "significant" | "critical";
  domain: string | null;
  resolution_status: string;
  created_at: string;
}

export interface GapResponse {
  id: string;
  case_id: string;
  workflow_id: string;
  description: string;
  what_is_missing: string;
  why_needed: string | null;
  priority: "low" | "medium" | "high" | "critical";
  related_entity_ids: string[] | null;
  suggested_actions: string | null;
  created_at: string;
}

export interface TaskResponse {
  id: string;
  case_id: string;
  workflow_id: string;
  title: string;
  description: string;
  task_type: string;
  priority: "low" | "medium" | "high" | "critical";
  status: "pending" | "in_progress" | "completed" | "dismissed";
  source_hypothesis_id: string | null;
  source_contradiction_id: string | null;
  source_gap_id: string | null;
  created_at: string;
}

export interface KeyFindingResponse {
  title: string;
  description: string;
  importance_rank: number;
  source_finding_ids: string[];
}

export interface VerdictResponse {
  verdict: string;
  evidence_strength: "Conclusive" | "Substantial" | "Inconclusive";
  key_strengths: string[];
  key_weaknesses: string[];
}

export interface SynthesisResponse {
  id: string;
  case_id: string;
  workflow_id: string;
  case_summary: string | null;
  case_verdict: VerdictResponse | null;
  cross_modal_links: unknown[] | null;
  cross_domain_conclusions: unknown[] | null;
  key_findings_summary: string | null; // JSON string of KeyFindingResponse[]
  risk_assessment: string | null;
  timeline_event_count: number;
  created_at: string;
}
```

**2. Create `frontend/src/lib/api/synthesis.ts`** with ABOUTME comment.

Follow the pattern from `lib/api/graph.ts` -- use the same auth/fetch pattern:

```typescript
const API_BASE = process.env.NEXT_PUBLIC_API_URL || "";

async function fetchWithAuth(url: string): Promise<Response> {
  const response = await fetch(url, {
    credentials: "include",
    headers: { "Content-Type": "application/json" },
  });
  if (!response.ok) {
    throw new Error(`API error: ${response.status} ${response.statusText}`);
  }
  return response;
}

export async function fetchSynthesis(caseId: string): Promise<SynthesisResponse> { ... }
export async function fetchHypotheses(caseId: string, status?: string): Promise<HypothesisResponse[]> { ... }
export async function fetchContradictions(caseId: string, severity?: string): Promise<ContradictionResponse[]> { ... }
export async function fetchGaps(caseId: string, priority?: string): Promise<GapResponse[]> { ... }
export async function fetchTasks(caseId: string, taskType?: string, status?: string): Promise<TaskResponse[]> { ... }
```

Each function: build URL with query params, call fetchWithAuth, parse JSON, return typed data. Handle 404 for fetchSynthesis by returning null.

**3. Create `frontend/src/hooks/useSynthesisData.ts`** with ABOUTME comment.

Create React Query hooks following the `use-case-graph.ts` pattern:

```typescript
export function useSynthesis(caseId: string) {
  return useQuery({
    queryKey: ["synthesis", caseId],
    queryFn: () => fetchSynthesis(caseId),
    staleTime: 30_000,
    retry: 1,
  });
}

export function useHypotheses(caseId: string) {
  return useQuery({
    queryKey: ["hypotheses", caseId],
    queryFn: () => fetchHypotheses(caseId),
    staleTime: 30_000,
  });
}

export function useContradictions(caseId: string) {
  return useQuery({
    queryKey: ["contradictions", caseId],
    queryFn: () => fetchContradictions(caseId),
    staleTime: 30_000,
  });
}

export function useGaps(caseId: string) {
  return useQuery({
    queryKey: ["gaps", caseId],
    queryFn: () => fetchGaps(caseId),
    staleTime: 30_000,
  });
}

export function useTasks(caseId: string) {
  return useQuery({
    queryKey: ["tasks", caseId],
    queryFn: () => fetchTasks(caseId),
    staleTime: 30_000,
  });
}
```
  </action>
  <verify>Run `cd /Users/siddharth/Development/Hackathons/Gemini_3_2025/holmes/frontend && bun run typecheck` -- no type errors in the new files.</verify>
  <done>TypeScript types match backend API responses, API client has 5 fetch functions with auth, 5 React Query hooks with 30s stale time</done>
</task>

<task type="auto">
  <name>Task 2: Verdict view components + CC tab toggle + DetailSidebar</name>
  <files>
    frontend/src/components/verdict/VerdictView.tsx
    frontend/src/components/verdict/VerdictSummary.tsx
    frontend/src/components/verdict/HypothesisCard.tsx
    frontend/src/components/verdict/ContradictionCard.tsx
    frontend/src/components/verdict/GapCard.tsx
    frontend/src/components/verdict/TaskCard.tsx
    frontend/src/components/verdict/KeyFindingCard.tsx
    frontend/src/components/verdict/HypothesisDetailPanel.tsx
    frontend/src/components/verdict/ContradictionDetailPanel.tsx
    frontend/src/components/verdict/GapDetailPanel.tsx
    frontend/src/types/detail-sidebar.ts
    frontend/src/components/app/detail-sidebar.tsx
    frontend/src/app/(app)/cases/[id]/command-center/page.tsx
    frontend/src/components/CommandCenter/CommandCenter.tsx
  </files>
  <action>
**1. Add DetailSidebar content types to `frontend/src/types/detail-sidebar.ts`**:

Add 3 new interfaces to the discriminated union:

```typescript
import type { HypothesisResponse, ContradictionResponse, GapResponse } from "./synthesis";

export interface VerdictHypothesisContent {
  type: "verdict-hypothesis";
  props: { hypothesis: HypothesisResponse; caseId: string };
}

export interface VerdictContradictionContent {
  type: "verdict-contradiction";
  props: { contradiction: ContradictionResponse; caseId: string };
}

export interface VerdictGapContent {
  type: "verdict-gap";
  props: { gap: GapResponse; caseId: string };
}
```

Add these 3 to the `SidebarContentDescriptor` union type.

**2. Add render cases in `frontend/src/components/app/detail-sidebar.tsx`**:

In the switch/if-chain that renders content based on `type`, add cases for `"verdict-hypothesis"`, `"verdict-contradiction"`, `"verdict-gap"`. Each renders the corresponding DetailPanel component (created below). Use lazy imports if the file follows that pattern.

**3. Create Verdict components** (all in `frontend/src/components/verdict/`):

All components should follow the Holmes design system (dark theme, warm neutrals, Liquid Glass aesthetic). Use Tailwind classes consistent with existing components like `FilterPanel.tsx` and `EntityTimeline.tsx`.

**VerdictSummary.tsx**: Renders case_summary + verdict at top of Verdict view.
- Case summary as prose paragraphs
- Verdict box: evidence_strength badge (Conclusive=green, Substantial=amber, Inconclusive=red), verdict text, key_strengths list (green bullets), key_weaknesses list (red bullets)
- Props: `{ synthesis: SynthesisResponse | null; isLoading: boolean }`

**KeyFindingCard.tsx**: Compact card for a key finding.
- Rank number badge (1-10), title, description (truncated to 2 lines), source count
- Props: `{ finding: KeyFindingResponse; rank: number; onClick?: () => void }`

**HypothesisCard.tsx**: Card with confidence visualization.
- Colored dot: red (<40), amber (40-60), green (>60) + percentage text (e.g. "73%")
- Claim text (2-3 lines), status badge (PENDING/SUPPORTED/REFUTED), evidence count
- Click handler: opens DetailSidebar
- Props: `{ hypothesis: HypothesisResponse; onClick: () => void }`

**ContradictionCard.tsx**: Side-by-side claim comparison.
- Two columns: Claim A (left) vs Claim B (right) with VS badge in center
- Severity badge (minor=gray, significant=amber, critical=red)
- Domain tag, source excerpts preview
- Props: `{ contradiction: ContradictionResponse; onClick: () => void }`

**GapCard.tsx**: Gap with priority and actionable suggestion.
- Priority badge (colored: critical=red, high=orange, medium=amber, low=gray)
- Description, what_is_missing, suggested_actions preview
- Props: `{ gap: GapResponse; onClick: () => void }`

**TaskCard.tsx**: Investigation task card.
- Task type icon/label, priority badge, status badge
- Title and description preview
- Props: `{ task: TaskResponse }`

**VerdictView.tsx**: Main scrollable view assembling all sections.
- Uses useSynthesis, useHypotheses, useContradictions, useGaps, useTasks hooks
- Parse key_findings from synthesis.key_findings_summary (JSON string -> KeyFindingResponse[])
- Sections in order (per CONTEXT.md):
  1. VerdictSummary (summary + verdict + evidence strength)
  2. Key Findings section header + KeyFindingCard grid
  3. Hypotheses section header + HypothesisCard list
  4. Contradictions section header + ContradictionCard list
  5. Evidence Gaps section header + GapCard list
  6. Investigation Tasks section header + TaskCard list
- Each section has a heading with count badge
- Loading state: skeleton/spinner
- Empty state: "Run analysis to generate intelligence" message
- Click handlers: setContent on DetailSidebar dispatch for hypothesis/contradiction/gap items
- Props: `{ caseId: string }`

**HypothesisDetailPanel.tsx**: Full detail panel for sidebar.
- Full claim text, confidence meter, reasoning, evidence list (supporting in green, contradicting in red, neutral in gray), each evidence item shows excerpt
- Props: `{ hypothesis: HypothesisResponse; caseId: string }`

**ContradictionDetailPanel.tsx**: Full detail panel for sidebar.
- Full claim_a and claim_b with excerpts, severity explanation, domain
- Props: `{ contradiction: ContradictionResponse; caseId: string }`

**GapDetailPanel.tsx**: Full detail panel for sidebar.
- Full description, what_is_missing, why_needed, suggested_actions (full text), related entities
- Props: `{ gap: GapResponse; caseId: string }`

**4. Add tab toggle to Command Center page**:

Modify `frontend/src/app/(app)/cases/[id]/command-center/page.tsx`:
- Add tab state using URL search params (per RESEARCH.md Pitfall 4): `const [activeTab, setActiveTab] = useState<"agent-flow" | "verdict">(() => searchParams.get("tab") === "verdict" ? "verdict" : "agent-flow")`. Use `useSearchParams` from next/navigation.
- Track synthesis readiness: add a `synthesiReady` state boolean. Set it to true when the `agentStates` map contains a completed "synthesis" agent OR when synthesis API returns data on initial load. Also listen for `synthesis-data-ready` SSE event type in useAgentStates (check if the hook already handles this event type -- if not, it will need a small update to detect the event and expose a flag).
- Conditionally render: if activeTab === "agent-flow", render CommandCenter. If "verdict", render VerdictView.
- Update URL when tab changes: `router.replace(\`?tab=${tab}\`, { scroll: false })`

Modify `frontend/src/components/CommandCenter/CommandCenter.tsx`:
- Add a tab toggle UI in the CanvasShell header area (or just above the canvas).
- The tab toggle should be a simple two-button pill group: "Agent Flow" | "Verdict"
- "Verdict" button: disabled with opacity-50 and tooltip "Analysis in progress..." when synthesis not ready. Enabled + clickable when synthesis data is available.
- Props: add `activeTab`, `onTabChange`, `synthesisReady` props. Alternatively, the tab toggle can live in page.tsx above the conditional render -- this is Claude's discretion per CONTEXT.md.
- The tab toggle should be rendered OUTSIDE the conditional render so it's always visible regardless of which view is active.

The simplest approach: render the tab toggle in `page.tsx` directly (above the CommandCenter/VerdictView conditional), not inside CommandCenter.tsx. This avoids prop drilling through CommandCenter. The tab toggle is a simple flex row with two buttons.
  </action>
  <verify>Run `cd /Users/siddharth/Development/Hackathons/Gemini_3_2025/holmes/frontend && bun run typecheck` -- no type errors. Then `bun run build` -- build succeeds.</verify>
  <done>Tab toggle shows "Agent Flow" and "Verdict" in Command Center page. Verdict tab disabled until synthesis completes. VerdictView renders 6 sections (Summary, Key Findings, Hypotheses, Contradictions, Gaps, Tasks). Clicking items opens DetailSidebar. Hypothesis cards show colored confidence dots. Contradiction cards show side-by-side claims. Tab state persists in URL params.</done>
</task>

</tasks>

<verification>
- Command Center page shows tab toggle between "Agent Flow" and "Verdict"
- Verdict tab is greyed out before synthesis data exists
- VerdictView fetches from all 5 synthesis API endpoints
- Each card type renders with proper styling and click handlers
- DetailSidebar opens with full detail panel for hypotheses, contradictions, gaps
- Tab state survives page refresh (URL search params)
- `bun run typecheck` and `bun run build` pass
</verification>

<success_criteria>
- Users see a conclusive Verdict view after pipeline completes
- Hypothesis cards display colored confidence dot (red/amber/green) + percentage
- Contradiction cards show side-by-side claim comparison with severity badge
- Gap cards show priority + actionable suggestions
- Tab toggle is intuitive and disabled state builds anticipation (per CONTEXT.md)
- No `any` types in TypeScript code
</success_criteria>

<output>
After completion, create `.planning/phases/08-synthesis-intelligence/08-04-SUMMARY.md`
</output>
