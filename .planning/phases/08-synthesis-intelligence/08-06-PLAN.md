---
phase: 08-synthesis-intelligence
plan: 06
type: execute
wave: 3
depends_on: ["08-04", "08-05"]
files_modified:
  - frontend/src/types/detail-sidebar.ts
  - frontend/src/components/app/detail-sidebar.tsx
  - frontend/src/components/verdict/HypothesisDetailPanel.tsx
  - frontend/src/components/verdict/ContradictionDetailPanel.tsx
  - frontend/src/components/verdict/GapDetailPanel.tsx
  - frontend/src/app/(app)/cases/[id]/command-center/page.tsx
  - frontend/src/hooks/useCommandCenterSSE.ts
autonomous: true

must_haves:
  truths:
    - "Command Center page has tab toggle between Agent Flow and Verdict"
    - "Verdict tab is disabled/greyed with 'Analysis in progress...' before synthesis completes"
    - "Verdict tab activates when synthesis-data-ready SSE event received"
    - "Clicking a hypothesis/contradiction/gap item opens DetailSidebar with full details"
    - "Tab state persists in URL search params across navigation"
  artifacts:
    - path: "frontend/src/types/detail-sidebar.ts"
      provides: "3 new SidebarContentDescriptor union members for verdict items"
      contains: "verdict-hypothesis"
    - path: "frontend/src/components/verdict/HypothesisDetailPanel.tsx"
      provides: "Full hypothesis detail with evidence list"
    - path: "frontend/src/components/verdict/ContradictionDetailPanel.tsx"
      provides: "Full contradiction detail with excerpts"
    - path: "frontend/src/components/verdict/GapDetailPanel.tsx"
      provides: "Full gap detail with suggested actions"
    - path: "frontend/src/app/(app)/cases/[id]/command-center/page.tsx"
      provides: "Tab toggle + conditional render of CommandCenter vs VerdictView"
  key_links:
    - from: "frontend/src/app/(app)/cases/[id]/command-center/page.tsx"
      to: "frontend/src/components/verdict/VerdictView.tsx"
      via: "Conditional render based on activeTab state"
      pattern: "activeTab.*verdict"
    - from: "frontend/src/types/detail-sidebar.ts"
      to: "frontend/src/components/verdict/HypothesisDetailPanel.tsx"
      via: "SidebarContentDescriptor union member"
      pattern: "verdict-hypothesis"
    - from: "frontend/src/hooks/useCommandCenterSSE.ts"
      to: "frontend/src/app/(app)/cases/[id]/command-center/page.tsx"
      via: "synthesisReady flag from SSE hook"
      pattern: "synthesis-data-ready|synthesisReady"
---

<objective>
Wire up DetailSidebar for verdict items, add Command Center tab toggle, and connect SSE synthesis-data-ready event to enable the Verdict tab.

Purpose: This is the integration layer connecting verdict components (Plan 05) to the existing app shell (DetailSidebar, Command Center page, SSE hooks). The tab toggle is how users discover and access synthesis results.

Output: 3 detail panels, updated DetailSidebar types + renderer, CC tab toggle with SSE-driven activation, SSE hook update for synthesis-data-ready.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-synthesis-intelligence/08-CONTEXT.md
@.planning/phases/08-synthesis-intelligence/08-RESEARCH.md
@.planning/phases/08-synthesis-intelligence/08-04-SUMMARY.md
@.planning/phases/08-synthesis-intelligence/08-05-SUMMARY.md
@frontend/src/types/detail-sidebar.ts
@frontend/src/components/app/detail-sidebar.tsx
@frontend/src/app/(app)/cases/[id]/command-center/page.tsx
@frontend/src/components/CommandCenter/CommandCenter.tsx
@frontend/src/hooks/useAgentStates.ts
@frontend/src/hooks/useCommandCenterSSE.ts
@frontend/src/types/synthesis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: DetailSidebar types + verdict detail panels</name>
  <files>
    frontend/src/types/detail-sidebar.ts
    frontend/src/components/app/detail-sidebar.tsx
    frontend/src/components/verdict/HypothesisDetailPanel.tsx
    frontend/src/components/verdict/ContradictionDetailPanel.tsx
    frontend/src/components/verdict/GapDetailPanel.tsx
  </files>
  <action>
**1. Add DetailSidebar content types to `frontend/src/types/detail-sidebar.ts`**:

Add 3 new interfaces to the discriminated union:

```typescript
import type { HypothesisResponse, ContradictionResponse, GapResponse } from "./synthesis";

export interface VerdictHypothesisContent {
  type: "verdict-hypothesis";
  props: { hypothesis: HypothesisResponse; caseId: string };
}

export interface VerdictContradictionContent {
  type: "verdict-contradiction";
  props: { contradiction: ContradictionResponse; caseId: string };
}

export interface VerdictGapContent {
  type: "verdict-gap";
  props: { gap: GapResponse; caseId: string };
}
```

Add these 3 to the `SidebarContentDescriptor` union type.

**2. Add render cases in `frontend/src/components/app/detail-sidebar.tsx`**:

In the switch/if-chain that renders content based on `type`, add cases for `"verdict-hypothesis"`, `"verdict-contradiction"`, `"verdict-gap"`. Each renders the corresponding DetailPanel component. Use lazy imports if the file follows that pattern.

**3. Create detail panel components** (in `frontend/src/components/verdict/`):

**HypothesisDetailPanel.tsx**: Full detail panel for sidebar.
- Full claim text, confidence meter (visual bar + percentage), reasoning text
- Evidence list: supporting items in green, contradicting in red, neutral in gray
- Each evidence item shows finding_id + excerpt
- Props: `{ hypothesis: HypothesisResponse; caseId: string }`

**ContradictionDetailPanel.tsx**: Full detail panel for sidebar.
- Full claim_a and claim_b with excerpts, severity explanation, domain tag
- Source excerpts with finding IDs
- Props: `{ contradiction: ContradictionResponse; caseId: string }`

**GapDetailPanel.tsx**: Full detail panel for sidebar.
- Full description, what_is_missing, why_needed, suggested_actions (full text), related entity IDs
- Priority badge (same colors as GapCard)
- Props: `{ gap: GapResponse; caseId: string }`
  </action>
  <verify>Run `cd /Users/siddharth/Development/Hackathons/Gemini_3_2025/holmes/frontend && bun run typecheck` -- no type errors.</verify>
  <done>3 verdict types added to SidebarContentDescriptor union, detail-sidebar.tsx renders all 3 panel types, 3 detail panel components created with full detail display</done>
</task>

<task type="auto">
  <name>Task 2: Command Center tab toggle + SSE synthesis readiness</name>
  <files>
    frontend/src/app/(app)/cases/[id]/command-center/page.tsx
    frontend/src/hooks/useCommandCenterSSE.ts
  </files>
  <action>
**1. Update SSE hook for synthesis-data-ready event**:

Check `frontend/src/hooks/useCommandCenterSSE.ts` (or `useAgentStates.ts` -- whichever manages the Command Center SSE connection). Add handling for the `synthesis-data-ready` event type:

- When `synthesis-data-ready` event is received, expose a `synthesisReady: boolean` flag (set to true)
- Also invalidate React Query caches for synthesis data: call `queryClient.invalidateQueries({ queryKey: ["synthesis"] })` and similarly for hypotheses, contradictions, gaps, tasks query keys
- If the hook doesn't already return a structured object, add `synthesisReady` to its return value
- The hook should also detect if synthesis has already completed on initial page load by checking if the agentStates map contains a "synthesis" agent in "complete" status

**2. Add tab toggle to Command Center page**:

Modify `frontend/src/app/(app)/cases/[id]/command-center/page.tsx`:

- Add tab state using URL search params (per RESEARCH.md Pitfall 4): `const [activeTab, setActiveTab] = useState<"agent-flow" | "verdict">(() => searchParams.get("tab") === "verdict" ? "verdict" : "agent-flow")`. Use `useSearchParams` from next/navigation.
- Get `synthesisReady` flag from the SSE hook. Also as a fallback, use the `useSynthesis` hook from Plan 04 -- if it returns data (not null), synthesis is ready.
- Render tab toggle ABOVE the conditional content (so it's always visible):
  - Simple two-button pill group: "Agent Flow" | "Verdict"
  - "Verdict" button: disabled with opacity-50 and cursor-not-allowed when synthesis not ready. Show tooltip "Analysis in progress..." on hover when disabled. Enabled + clickable when synthesis data is available.
  - Active tab gets a highlighted background (follow existing UI patterns for active states)
- Conditionally render: if activeTab === "agent-flow", render existing CommandCenter component. If "verdict", render VerdictView.
- Wire VerdictView's `onOpenDetail` prop to the DetailSidebar dispatch (check how the page currently opens the sidebar for KG items and follow the same pattern)
- Update URL when tab changes: `router.replace(\`?tab=${tab}\`, { scroll: false })`
  </action>
  <verify>Run `cd /Users/siddharth/Development/Hackathons/Gemini_3_2025/holmes/frontend && bun run typecheck && bun run build` -- both pass.</verify>
  <done>Tab toggle shows "Agent Flow" and "Verdict" in Command Center page. Verdict tab disabled until synthesis completes (via SSE or initial data fetch). SSE hook handles synthesis-data-ready event and invalidates React Query caches. Tab state persists in URL params.</done>
</task>

</tasks>

<verification>
- Command Center page shows tab toggle between "Agent Flow" and "Verdict"
- Verdict tab is greyed out before synthesis data exists
- synthesis-data-ready SSE event enables the Verdict tab
- Clicking hypothesis/contradiction/gap cards opens DetailSidebar with correct panel
- Tab state survives page refresh (URL search params)
- `bun run typecheck` and `bun run build` pass
</verification>

<success_criteria>
- Tab toggle is intuitive and disabled state builds anticipation (per CONTEXT.md)
- DetailSidebar opens with full detail for hypotheses, contradictions, gaps
- SSE-driven activation provides seamless transition when synthesis completes
- No `any` types in TypeScript code
</success_criteria>

<output>
After completion, create `.planning/phases/08-synthesis-intelligence/08-06-SUMMARY.md`
</output>
