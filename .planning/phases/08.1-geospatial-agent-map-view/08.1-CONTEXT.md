# Phase 8.1: Geospatial Agent & Map View - Context

**Gathered:** 2026-02-09
**Status:** Ready for planning

<domain>
## Phase Boundary

On-demand geospatial intelligence extraction and visualization. User triggers analysis from the Geospatial tab to extract location references from case evidence (synthesis outputs, findings, KG entities, timeline), geocode them via Google Maps API, detect movement patterns, and display on an interactive map with citations. The agent is purely on-demand (not auto-triggered) and results are hybrid storage (DB persistent + regenerable).

</domain>

<decisions>
## Implementation Decisions

### Trigger flow & status feedback
- "Generate Geospatial Intelligence" button lives in **top toolbar next to map controls** (not floating button, not empty state overlay)
- Processing feedback: **Indeterminate spinner with status text** ("Analyzing locations...") — no progress bar, no live counter
- Regeneration after new evidence: **Manual refresh button** ("Regenerate with new evidence") — user controls when to refresh, no automatic detection
- No locations found: **Empty state message with suggestions** ("No locations found. Try uploading evidence with addresses or place names.")

### Map interaction & visual encoding
- Location markers: **Color-coded pins using Knowledge Graph entity color palette** — reuse existing color system for consistency
- Movement paths: **Solid lines for confirmed, dashed for inferred** — line style indicates confidence level
- Click interaction: **Both: tooltip on hover (preview), detail panel on click (full intelligence)** — two-level disclosure
- Marker clustering: **Smart offset (spread nearby markers slightly)** — no clustering, no overlap; subtle positioning offset

### Location ambiguity & quality control
- Ambiguous locations: **Don't show on map, list in separate "Unresolved Locations" panel** — map only shows confident locations
- Manual corrections: **No manual edits** — corrections only via evidence updates, then regeneration (keep system read-only)
- Confidence indicator: **Yes, but only in detail panel (not on map markers)** — keeps map clean, confidence visible on click
- Location deletion: **No, only full regeneration can change locations** — all-or-nothing approach, avoids partial state issues

### Intelligence panel content & citations
- Panel focus: **Events that happened at this location (timeline-centric)** — "What happened here" view with chronological events
- Temporal display: **Chronological list with date/time labels** — text-based list, compact and readable
- Citation format: **Expandable source section per event in right sidebar** → opens standard source panel/modal on top of map (same pattern as Knowledge Graph)
- Cross-references: **No cross-references to hypotheses/entities** — keep panel focused on location-specific information only

### Claude's Discretion
- Tooltip content and styling (hover preview)
- Exact positioning algorithm for smart offset
- "Unresolved Locations" panel layout and presentation
- Geocoding cache strategy and expiration
- Error handling for Google Maps API failures

</decisions>

<specifics>
## Specific Ideas

- "Use the same color palette as the Knowledge Graph entity colors for location markers" — visual consistency across case views
- "Source panel should work exactly like the Knowledge Graph source viewer" — expandable source section in sidebar opens source panel/modal overlay
- Panel structure: timeline-centric view showing "what happened here" rather than "who was here" or "why we know this"

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope.

</deferred>

---

*Phase: 08.1-geospatial-agent-map-view*
*Context gathered: 2026-02-09*
